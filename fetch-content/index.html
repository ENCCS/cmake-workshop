<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Automated dependency handling with FetchContent &mdash; CMake Workshop</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css" />
      <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css" />
      <link rel="stylesheet" type="text/css" href="../_static/overrides.css" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script data-domain="enccs.github.io/cmake-workshop" defer="defer" src="https://plausible.io/js/script.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Mixing Python and compiled languages" href="../python-bindings/" />
    <link rel="prev" title="Finding and using dependencies" href="../dependencies/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            CMake Workshop
              <img src="../_static/ENCCS.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/">Setting up your system</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../hello-cmake/">From sources to executables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cmake-syntax/">CMake syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hello-ctest/">Creating and running tests with CTest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../probing/">Probing compilation, linking, and execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../targets/">Target-based build systems with CMake</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dependencies/">Finding and using dependencies</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Automated dependency handling with <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-fetchcontent-module">The <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#unit-testing-with-catch2">Unit testing with Catch2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../python-bindings/">Mixing Python and compiled languages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips-and-tricks/">Using CMake: tips and tricks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../environment/">Detecting your environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cxx-fortran/">Mixing C++ and Fortran</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick-reference/">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zbibliography/">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">CMake Workshop</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Automated dependency handling with <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code></li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ENCCS/cmake-workshop/blob/main/content/fetch-content.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="automated-dependency-handling-with-fetchcontent">
<span id="fetch-content"></span><h1>Automated dependency handling with <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code><a class="headerlink" href="#automated-dependency-handling-with-fetchcontent" title="Permalink to this heading"></a></h1>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>Is there a way to automatically satisfy the dependencies of our code?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn how to download your dependencies at configure-time with <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code>.</p></li>
<li><p>Learn how fetched content can be used natively within your build system.</p></li>
</ul>
</div>
<p>CMake offers <strong>two modules</strong> to satisfy missing dependencies on-the-fly:
the <code class="docutils literal notranslate"><span class="pre">ExternalProject</span></code> and <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> modules.</p>
<dl class="simple">
<dt>Using <code class="docutils literal notranslate"><span class="pre">ExternalProject</span></code></dt><dd><ul class="simple">
<li><p>The download step happens at <a class="reference external" href="https://cmake.org/cmake/help/latest/module/ExternalProject.html">project build-time</a>.</p></li>
<li><p>You can handle dependencies that <strong>do not</strong> use CMake.</p></li>
<li><p>You need to rewrite your whole build system as a <a class="reference external" href="https://github.com/dev-cafe/cmake-cookbook/blob/master/chapter-08/README.md">superbuild</a>.</p></li>
</ul>
</dd>
<dt>Using <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code></dt><dd><ul class="simple">
<li><p>The download step happens at <a class="reference external" href="https://cmake.org/cmake/help/latest/module/FetchContent.html">project configure-time</a>.</p></li>
<li><p>You can only manage dependencies that use CMake.</p></li>
<li><p>It’s an well-delimited change to an existing CMake build system.</p></li>
</ul>
</dd>
</dl>
<p>Both are extremely powerful mechanisms, but you should use them with care.
Often, comprehensive documentation will suffice to help users set up their
environment to build your code successfully!  In this episode, we will discuss
the <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> module.</p>
<section id="the-fetchcontent-module">
<h2>The <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> module<a class="headerlink" href="#the-fetchcontent-module" title="Permalink to this heading"></a></h2>
<p>To fetch dependencies on-the-fly at configure-time you will include the built-in
CMake module <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code>.  This module has been part of CMake since its
3.11 version and has been steadily improved since then.</p>
<p>There are two steps in a <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code>-based workflow:</p>
<ol class="arabic">
<li><p><strong>Declaring</strong> the content to fetch with <a class="reference internal" href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><span class="xref std std-term"><code class="docutils literal notranslate">FetchContent_Declare</code></span></a>. This can be a
tarball (local or remote), a local folder, or a version control repository
(Git, SVN, etc.).</p>
<div class="admonition-fetchcontent-declare signature toggle-shown dropdown admonition" id="signature-0">
<p class="admonition-title"><a class="reference internal" href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><span class="xref std std-term"><code class="docutils literal notranslate">FetchContent_Declare</code></span></a></p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">FetchContent_Declare</span><span class="p">(</span><span class="s">&lt;name&gt;</span><span class="w"> </span><span class="s">&lt;contentOptions&gt;...</span><span class="p">)</span>
</pre></div>
</div>
<p>The command accepts as <code class="docutils literal notranslate"><span class="pre">&lt;contentOptions&gt;</span></code> the same options one would give
to <code class="docutils literal notranslate"><span class="pre">ExternalProject_Add</span></code> in the <em>download</em> and <em>update/patch</em> <a class="reference external" href="https://cmake.org/cmake/help/latest/module/ExternalProject.html#command:externalproject_add">steps</a>.</p>
<p>To download code from a Git repository, you would set the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GIT_REPOSITORY</span></code>, the location of the repository.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GIT_TAG</span></code>, the revision (tag, branch name, commit hash) to check out.</p></li>
</ul>
<p>whereas to download a tarball you only need set:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">URL</span></code>, the online location of the tarball.</p></li>
</ul>
</div>
</li>
<li><p><strong>Populating</strong> the content with <a class="reference internal" href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><span class="xref std std-term"><code class="docutils literal notranslate">FetchContent_MakeAvailable</code></span></a>. This commands
<em>adds</em> the targets declared in the external content to your build system.</p>
<div class="admonition-fetchcontent-makeavailable signature toggle-shown dropdown admonition" id="signature-1">
<p class="admonition-title"><a class="reference internal" href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><span class="xref std std-term"><code class="docutils literal notranslate">FetchContent_MakeAvailable</code></span></a></p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">FetchContent_MakeAvailable</span><span class="p">(</span><span class="w"> </span><span class="s">&lt;name1&gt;</span><span class="w"> </span><span class="s">[&lt;name2&gt;...]</span><span class="w"> </span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Since targets from the external project are added to your own project, you
will be able to use them in the same way you would when obtaining them
through a call to <a class="reference internal" href="https://cmake.org/cmake/help/latest/command/find_package.html"><span class="xref std std-term"><code class="docutils literal notranslate">find_package</code></span></a>: you can use <em>found</em> and <em>fetched</em> content
in the same exact way.
If you need to set options for building the external project, you will set
them as CMake variables <em>before</em> calling <a class="reference internal" href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><span class="xref std std-term"><code class="docutils literal notranslate">FetchContent_MakeAvailable</code></span></a>.</p>
</li>
</ol>
<section id="unit-testing-with-catch2">
<h3>Unit testing with Catch2<a class="headerlink" href="#unit-testing-with-catch2" title="Permalink to this heading"></a></h3>
<p>Unit testing is a valuable technique in software engineering: it can help
identify functional regressions with a very fine level of control, since each
unit test is meant to exercise isolated components in your codebase.
Equipping your codebase with integration <em>and</em> unit tests is very good practice.</p>
<p>There are many unit testing frameworks for the C++ language. Each of them
stresses a slightly different approach to unit testing and comes with its own
peculiarities in set up and usage.
In this episode, we will show how to use <a class="reference external" href="https://github.com/catchorg/Catch2">Catch2</a> a very popular unit testing framework
which emphasizes a test-driven development workflow.
Catch2 is distributed as a single header file, which is one of its most
appealing features: it can easily be included in any project. Rather than
download the header file and adding it to our codebase, we can use
<code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> to satisfy this dependency for us when needed.</p>
<div class="admonition-exercise-26-catch2-reloaded exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise 26: Catch2 reloaded</p>
<p>We want to use the Catch2 unit testing framework for our code.  In this
exercise, we will download the Catch2 project at configure-time from its
<a class="reference external" href="https://github.com/catchorg/Catch2">GitHub repository</a>.</p>
<p>A scaffold for the project is in <code class="docutils literal notranslate"><span class="pre">content/code/day-2/26_more-catch2</span></code>.</p>
<ol class="arabic simple">
<li><p>Create a C++ project.</p></li>
<li><p>Set the C++ standard to C++14. Catch2 will work with C++11 too.</p></li>
<li><p>Create a library from the <code class="docutils literal notranslate"><span class="pre">sum_integers.cpp</span></code> source file.</p></li>
<li><p>Link the library into a <code class="docutils literal notranslate"><span class="pre">sum_up</span></code> executable.</p></li>
<li><p>Include the <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> module and declare the <code class="docutils literal notranslate"><span class="pre">Catch2</span></code> content. We
want to download the <code class="docutils literal notranslate"><span class="pre">v2.13.4</span></code> tag from the <a class="reference external" href="https://github.com/catchorg/Catch2">official Git repository</a>.</p></li>
<li><p>Make the <code class="docutils literal notranslate"><span class="pre">Catch2</span></code> content available.</p></li>
<li><p>Create the <code class="docutils literal notranslate"><span class="pre">cpp_test</span></code> executable.</p></li>
<li><p>Enable testing and add a test. You will have to check how to call a Catch2
executable in the <a class="reference external" href="https://github.com/catchorg/Catch2/blob/v2.x/docs/command-line.md#specifying-which-tests-to-run">documentation</a>.</p></li>
<li><p>Try running your tests.</p></li>
</ol>
<ul>
<li><p>What differences do you note in the configuration step?</p></li>
<li><p>What happens if you forget to issue the <a class="reference internal" href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><span class="xref std std-term"><code class="docutils literal notranslate">FetchContent_MakeAvailable</code></span></a> command?</p></li>
<li><p>What targets are built in the project? Which ones are from Catch2? You can
use the following command to obtain a list of all available targets:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cmake<span class="w"> </span>--build<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span><span class="nb">help</span>
</pre></div>
</div>
</li>
</ul>
<p>A working solution is in the <code class="docutils literal notranslate"><span class="pre">solution</span></code> subfolder.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> is a powerful module in your CMake toolbox. <strong>Beware!</strong>
Satisfying <em>every</em> dependency of your code in this way will make the duration
of both the configuration and build stages balloon.</p>
</div>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>CMake lets you satisfy dependencies <em>on-the-fly</em>.</p></li>
<li><p>You can do so at build-time with <code class="docutils literal notranslate"><span class="pre">ExternalProject</span></code>, but you need to adopt
a superbuild framework.</p></li>
<li><p>At configure-time, you can use the <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> module: it can only be
applied with dependencies that also use CMake.</p></li>
</ul>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../dependencies/" class="btn btn-neutral float-left" title="Finding and using dependencies" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../python-bindings/" class="btn btn-neutral float-right" title="Mixing Python and compiled languages" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, EuroCC National Competence Centre Sweden.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>